import{e as B,b as i,i as m,t as _,y as c,l as t,G as ge,S as E,x as te,m as ee,r as P,h as K,v as j,w as ne,j as le,k as X,C as G,z as ue,A as me,B as _e}from"./web-BP_Sm2kp.js";import{m as Se,M as ye,d as oe}from"./index-Da3s7cXh.js";import{S as we,L as ce,D as he}from"./delete_forever-LzAk5En3.js";import{C as Ce,L as Le,a as ze}from"./chevron_right-DrxW09Le.js";import{u as J}from"./index-ByPGQDE4.js";import{R as ke,e as Fe,c as Ie,s as Me,L as Ne}from"./index-By5Xq2HF.js";import{A as se}from"./components-C5epJ_uZ.js";import{d as W,u as De,e as be}from"./utc-B-W9tmtl.js";import{d as Re,t as Te,a as Ae}from"./index-CVjl_ltI.js";import{C as ae}from"./close-BXxffw09.js";import{g as qe}from"./session-Din5jGJq.js";import{h as Ee,j as Pe}from"./routing-DE3KDVov.js";import{c as ie}from"./createAsync-CxGUhFbC.js";/* empty css              */import{u as de,e as $e,l as He,a as Ze}from"./lists-CSN-izIX.js";/* empty css                    */import{g as Be}from"./user-DPU6oxOF.js";import"./lists-CLYPnM5D.js";function je(e){const l=oe(e[0],1,-135,{units:"kilometers"}),r=oe(e[2],1,45,{units:"kilometers"});return[...l.geometry.coordinates,...r.geometry.coordinates]}function Oe(e){return 2500/(e/5)}function Ye(e){const[l,r]=B({bounds:je(e.list.bbox)}),[d,{setSelectedLocationsId:u}]=J();function s(n){const $=n.target.queryRenderedFeatures(n.point),S=$[0].properties.locations_id;return u(S),$[0].geometry.coordinates}return i(ye,{class:"list-map",mapLib:Se,get options(){return{accessToken:"pk.eyJ1IjoibWJhZ3JhdGlvbmkiLCJhIjoiY21nYzdvYzRtMWRlaTJrczdhdmFvY3R1ZSJ9.q1gwOrfrGLBRKTef6ylZzQ",style:"https://api.maptiler.com/maps/dataviz-dark/style.json?key=UhseFH2iDqnVh2izRANY",touchZoomRotate:!1,dragRotate:!1,minZoom:1,maxZoom:20}},get viewport(){return l()},onViewportChange:n=>r(n),onMouseOver:{locations:n=>n.target.getCanvas().style.cursor="pointer"},onMouseLeave:{locations:n=>n.target.getCanvas().style.cursor=""},get children(){return[i(we,{get source(){return{id:"locations",type:"vector",tiles:["https://api.maptiler.com/tiles/streets/{z}/{x}/{y}.pbf?key=UhseFH2iDqnVh2izRANY/{z}/{x}/{y}.pbf?apiKey=UhseFH2iDqnVh2izRANY"],minzoom:1,maxzoom:24}},get children(){return[i(ce,{id:"locations",onClick:n=>{const $=s(n);n.target.flyTo({center:$,zoom:n.target.getZoom()>12?n.target.getZoom():12,duration:Oe(n.target.getZoom()),essential:!0})},get style(){return{type:"circle","source-layer":"locations",paint:{"circle-color":["case",["in",["get","locations_id"],["literal",e.list.sensorNodesIds]],"transparent","#A9B0BB"],"circle-stroke-color":["case",["in",["get","locations_id"],["literal",e.list.sensorNodesIds]],"transparent","#FFFFFF"],"circle-stroke-width":["interpolate",["linear"],["zoom"],2,1,14,4],"circle-radius":["interpolate",["linear"],["zoom"],1,3,12,14]}}}}),i(ce,{id:"listlocations",get style(){return{type:"circle","source-layer":"locations",paint:{"circle-color":["case",["in",["get","locations_id"],["literal",e.list.sensorNodesIds]],"#FEE172","transparent"],"circle-stroke-color":["case",["in",["get","locations_id"],["literal",e.list.sensorNodesIds]],"#33A3A1","transparent"],"circle-stroke-width":["interpolate",["linear"],["zoom"],2,1,14,4],"circle-radius":["interpolate",["linear"],["zoom"],1,3,12,14]}}}})]}}),i(Ce,{type:"navigation",position:"bottom-left",options:{showCompass:!1,showZoom:!0}})]}})}var Ve=_('<div class=no-locations-fallback><p class="type-subtitle-1 text-smoke-120">Lists allow you to collect and save a set of monitoring locations for easy access.</p><p class="type-subtitle-2 text-smoke-120">To start adding monitoring locations to your list, first find locations in the <!$><!/> map, and then click on "Add to list".');function Ge(){return(()=>{var e=m(Ve),l=e.firstChild,r=l.nextSibling,d=r.firstChild,u=d.nextSibling,[s,n]=c(u.nextSibling);return s.nextSibling,t(r,i(se,{href:"/",children:"Explore"}),s,n),e})()}var Je=_("<div class=location-info><div class=location-info__title><!$><!/><h3></h3></div><div class=location-info__body><div><div class=locality></div><div class=location-characteristics><div class=type-body-1>Provider</div><div class=type-body-2></div><div class=type-body-1>Type</div><div class=type-body-2></div><div class=type-body-1>Measures</div><div class=type-body-2></div></div></div><div class=location-measurements>"),Ue=_("<li class=location-list-item><!$><!/><button class=location-card-delete-btn type=button>"),We=_("<ul class=location-list>");W.extend(De);W.extend(Te);function Ke(e){const l={width:24,height:24,fill:"#FFFFFF"},[r,{setDeleteListLocationsId:d,toggleDeleteListLocationModalOpen:u}]=J(),[s,n]=B(),[$,S]=B(!0),a=()=>e.sensors.filter(v=>Number(v.parameter.id)===Number(r.listParametersId))?.[0]?.id,[h,y]=B([]);return te(async()=>{n(a()),y([]),s()&&y(await Re(s(),W.tz(Date.now()-1e3*60*60*24,e.timezone).format(),W.tz(Date.now(),e.timezone).format())),S(!1)}),(()=>{var g=m(Ue),v=g.firstChild,[L,f]=c(v.nextSibling),z=L.nextSibling;return t(g,i(se,{get href(){return`/locations/${e.id}`},get children(){var x=m(Je),b=x.firstChild,N=b.firstChild,[w,k]=c(N.nextSibling),C=w.nextSibling,F=b.nextSibling,I=F.firstChild,M=I.firstChild,D=M.nextSibling,A=D.firstChild,O=A.nextSibling,Y=O.nextSibling,H=Y.nextSibling,R=H.nextSibling,o=R.nextSibling,q=I.nextSibling;return t(b,(()=>{var p=ee(()=>!!e.ismonitor);return()=>p()?i(ke,{}):i(Fe,{})})(),w,k),t(C,()=>e.name),t(M,()=>e.country),t(O,()=>e.provider),t(H,()=>e.ismonitor?"Reference Grade":"Air sensor"),t(o,()=>e.sensors.map(p=>`${p.parameter.displayName} ${p.parameter.units}`).join(", ")),t(q,i(Le,{width:400,height:200,margin:60,xTicks:4,get dateFrom(){return W.tz(Date.now()-1e3*60*60*24,e.timezone).format()},get dateTo(){return W.tz(Date.now(),e.timezone).format()},get data(){return h()},scale:"linear",get loading(){return $()},get timezone(){return e.timezone},get noDataMessage(){return`This location does not measure ${r.listParameter}`}})),x}}),L,f),z.$$click=()=>{d(e.id),u()},t(z,i(he,l)),P(),g})()}function Qe(e){return(()=>{var l=m(We);return t(l,i(E,{get when(){return e.locations.length>0},get fallback(){return i(Ge,{})},get children(){return i(ge,{get each(){return e.locations},children:r=>i(Ke,r)})}})),l})()}K(["click"]);var Xe=_('<div><header class=location-detail-card-mini__header><div><h3 class="type-heading-3 text-white"></h3></div><div><button class=close-btn> <!$><!/> </button></div></header><div class=location-detail-card-mini__body><section class=section><span class=type-body-3></span></section><section class=section-grid><span class=type-subtitle-3>Type</span><span class=type-body-1></span><span class=type-subtitle-3>Measures</span><span class=type-body-1></span></section><section class=section-grid><span class=type-subtitle-3>Source</span><span class=type-body-1></span><span class=type-subtitle-3>Reporting</span><div class=reporting-cell><span class=type-body-1></span><span class=type-body-4></span></div></section></div><footer class=location-detail-card-mini__footer><!$><!/><!$><!/>');function et(){const e={width:24,height:24,fill:"#FFFFFF"},l=Ee(),r=ie(()=>qe(),{deferStream:!0}),[d,{clearLocationsId:u}]=J(),[s,n]=B();return te(async()=>{d.locationsId&&n(await Ae(d.locationsId))}),(()=>{var $=m(Xe),S=$.firstChild,a=S.firstChild,h=a.firstChild,y=a.nextSibling,g=y.firstChild,v=g.firstChild,L=v.nextSibling,[f,z]=c(L.nextSibling);f.nextSibling;var x=S.nextSibling,b=x.firstChild,N=b.firstChild,w=b.nextSibling,k=w.firstChild,C=k.nextSibling,F=C.nextSibling,I=F.nextSibling,M=w.nextSibling,D=M.firstChild,A=D.nextSibling,O=A.nextSibling,Y=O.nextSibling,H=Y.firstChild,R=H.nextSibling,o=x.nextSibling,q=o.firstChild,[p,T]=c(q.nextSibling),Z=p.nextSibling,[Q,U]=c(Z.nextSibling);return t(h,()=>s()?.results?.[0].name),g.$$click=()=>u(),t(g,i(ae,e),f,z),t(N,()=>s()?.results?.[0].country.name),t(C,()=>s()?.results?.[0].isMonitor?"Reference grade":"Air sensor"),t(I,()=>s()?.results?.[0].sensors.map(V=>`${V.parameter.displayName} ${V.parameter.units}`).join(", ")),t(A,()=>s()?.results?.[0].provider.name),t(H,(()=>{var V=ee(()=>!!s()?.results?.[0].datetimeLast);return()=>V()?`Updated ${Ie(s()?.results?.[0].datetimeFirst?.local)}`:"No measurements"})()),t(R,(()=>{var V=ee(()=>!!s()?.results?.[0].datetimeLast);return()=>V()?`Reporting since ${Me(s()?.results?.[0].datetimeFirst?.local)}`:"No measurements"})()),t(o,i(E,{get when(){return r()?.usersId},get children(){return i(Ne,{get redirect(){return l.pathname}})}}),p,T),t(o,i(se,{get href(){return`/locations/${d.locationsId}`},class:"icon-btn btn-primary",get children(){return["Show Details ",i(ze,e)]}}),Q,U),j(()=>ne($,`location-detail-card-mini ${d.locationsId?"":"location-detail-card-mini--translate"}`)),P(),$})()}K(["click"]);var tt=_('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 -960 960 960"><path d="m600-120-240-84-186 72q-20 8-37-4.5T120-170v-560q0-13 7.5-23t20.5-15l212-72 240 84 186-72q20-8 37 4.5t17 33.5v560q0 13-7.5 23T812-192zm-40-98v-468l-160-56v468zm80 0 120-40v-474l-120 46zm-440-10 120-46v-468l-120 40zm440-458v468zm-320-56v468z">');const it=(e={})=>(()=>{var l=m(tt);return le(l,e,!0,!0),P(),l})();var lt=_('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 -960 960 960"><path d="M360-240h440v-107H360zM160-613h120v-107H160zm0 187h120v-107H160zm0 186h120v-107H160zm200-186h440v-107H360zm0-187h440v-107H360zM160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160z">');const st=(e={})=>(()=>{var l=m(lt);return le(l,e,!0,!0),P(),l})();var nt=_("<div class=list-controls><label for=parameter-select>Parameters</label><select name=parameter-select id class=select>"),at=_("<div id=list-view>"),rt=_("<div id=map-view><!$><!/><!$><!/>"),ot=_("<div class=tab-view><header class=tab-view__header><nav class=tab-nav><a href=#><div><!$><!/>List</div></a><a href=#><div><!$><!/>Map</div></a></nav><!$><!/></header><section><!$><!/><!$><!/>"),ct=_("<option><!$><!/> <!$><!/> ");function dt(e){const l={width:24,height:24},[r,d]=B("list"),[u,s]=B([]),[n,{setListParametersId:$,setListParameter:S}]=J();return te(()=>{e.locations&&(s([...new Set(...e.locations.map(a=>a.sensors.map(h=>h.parameter)))]),u.length>0&&$(u()[0].id))}),(()=>{var a=m(ot),h=a.firstChild,y=h.firstChild,g=y.firstChild,v=g.firstChild,L=v.firstChild,[f,z]=c(L.nextSibling);f.nextSibling;var x=g.nextSibling,b=x.firstChild,N=b.firstChild,[w,k]=c(N.nextSibling);w.nextSibling;var C=y.nextSibling,[F,I]=c(C.nextSibling),M=h.nextSibling,D=M.firstChild,[A,O]=c(D.nextSibling),Y=A.nextSibling,[H,R]=c(Y.nextSibling);return g.$$click=()=>d("list"),t(v,i(st,X(l,{get class(){return`tab-icon ${r()=="list"?"tab-icon--active":""}`}})),f,z),x.$$click=()=>d("map"),t(b,i(it,X(l,{get class(){return`$'tab-icon' ${r()=="map"?"tab-icon--active":""}`}})),w,k),t(h,i(E,{get when(){return ee(()=>r()=="list")()&&e.locations.length>0},get children(){var o=m(nt),q=o.firstChild,p=q.nextSibling;return p.addEventListener("change",T=>{$(Number(T.target.value)),S(T.target.options[T.target.selectedIndex].text)}),t(p,i(ge,{get each(){return u()},children:T=>(()=>{var Z=m(ct),Q=Z.firstChild,[U,V]=c(Q.nextSibling),pe=U.nextSibling,fe=pe.nextSibling,[re,xe]=c(fe.nextSibling);return re.nextSibling,t(Z,()=>T.displayName,U,V),t(Z,()=>T.units,re,xe),j(()=>G(Z,"value",T.id)),Z})()})),j(()=>G(p,"value",n.listParametersId)),o}}),F,I),t(M,i(E,{get when(){return r()=="list"},get children(){var o=m(at);return t(o,i(Qe,e)),o}}),A,O),t(M,i(E,{get when(){return r()=="map"},get children(){var o=m(rt),q=o.firstChild,[p,T]=c(q.nextSibling),Z=p.nextSibling,[Q,U]=c(Z.nextSibling);return t(o,i(Ye,e),p,T),t(o,i(et,{}),Q,U),o}}),H,R),j(o=>{var q=`tab ${r()=="list"?"tab--active":""}`,p=`tab ${r()=="map"?"tab--active":""}`;return q!==o.e&&ne(v,o.e=q),p!==o.t&&ne(b,o.t=p),o},{e:void 0,t:void 0}),P(),a})()}K(["click"]);var $t=_('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 -960 960 960"><path d="M200-200h57l391-391-57-57-391 391zm-80 80v-170l528-527q12-11 26.5-17t30.5-6 31 6 26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120zm640-584-56-56zm-141 85-28-29 57 57z">');const ve=(e={})=>(()=>{var l=m($t);return le(l,e,!0,!0),P(),l})();var gt=_("<p role=alert id=error-message>"),ut=_('<dialog class=modal><form method=post><input type=hidden name=lists-id><header class=modal__header><h2 class=title><!$><!/>Edit list</h2><button id=close class=close-btn aria-label=close formnovalidate></button></header><div class=modal__body><div class=form-input><label for=list-name>Name</label><div class=form-input><input type=text name=list-name id=list-name-input class=text-input></div><label for=list-description>Description</label><input type=text name=list-description id=list-description-input class=text-input></div></div><footer class=modal__footer><!$><!/><button class="btn btn-secondary"id=cancel aria-label=close formnovalidate autofocus>Cancel</button><button class="btn btn-primary"type=submit autofocus>Create');function mt(e){const l={width:24,height:24,fill:"#FFFFFF"},[r,{toggleEditListModalOpen:d}]=J(),u=be(de),s=a=>{d(),a.preventDefault(),a.target.closest("dialog").close()},[n,$]=B();te(()=>{r.editListModalOpen&&n()?.showModal()});const S=a=>{a.target.closest("dialog").close(),d()};return(()=>{var a=m(ut),h=a.firstChild,y=h.firstChild,g=y.nextSibling,v=g.firstChild,L=v.firstChild,[f,z]=c(L.nextSibling);f.nextSibling;var x=v.nextSibling,b=g.nextSibling,N=b.firstChild,w=N.firstChild,k=w.nextSibling,C=k.firstChild,F=k.nextSibling,I=F.nextSibling,M=b.nextSibling,D=M.firstChild,[A,O]=c(D.nextSibling),Y=A.nextSibling,H=Y.nextSibling;return ue($,a),me(h,"action",de),t(v,i(ve,l),f,z),x.$$click=s,t(x,i(ae,l)),t(M,i(E,{get when(){return u.result},get children(){var R=m(gt);return _e(R,"color","red"),t(R,()=>u.result.message),R}}),A,O),Y.$$click=s,H.$$click=R=>S(R),j(()=>G(y,"value",e.listsId)),j(()=>G(C,"value",e.label)),j(()=>G(I,"value",e.description)),P(),a})()}K(["click"]);var _t=_("<p role=alert id=error-message>"),ht=_('<dialog class=modal><form method=post><header class=modal__header><h2 class=title><!$><!/>Remove location?</h2><button id=close class=close-btn aria-label=close formnovalidate></button></header><div class=modal__body><p><span class=type-subtitle-4>Warning</span> You are about to remove this location from your list. Click Delete if you are you sure want to proceed.</p></div><footer class=modal__footer><!$><!/><button class="btn btn-secondary"id=cancel aria-label=close formnovalidate autofocus>Cancel</button><input name=lists-id type=hidden><input name=locations-id type=hidden><button class="btn btn-primary"type=submit autofocus>Delete');function bt(e){const l={width:24,height:24,fill:"#FFFFFF"},[r,d]=B(),[u,{toggleDeleteListLocationModalOpen:s}]=J(),n=be($e),$=a=>{s(),a.preventDefault(),a.target.closest("dialog").close()},S=a=>{a.target.closest("dialog").close(),s()};return te(()=>{u.deleteListLocationModalOpen&&r()?.showModal()}),(()=>{var a=m(ht),h=a.firstChild,y=h.firstChild,g=y.firstChild,v=g.firstChild,[L,f]=c(v.nextSibling);L.nextSibling;var z=g.nextSibling,x=y.nextSibling,b=x.nextSibling,N=b.firstChild,[w,k]=c(N.nextSibling),C=w.nextSibling,F=C.nextSibling,I=F.nextSibling,M=I.nextSibling;return ue(d,a),me(h,"action",$e),t(g,i(he,l),L,f),z.$$click=$,t(z,i(ae,l)),t(b,i(E,{get when(){return n.result},get children(){var D=m(_t);return _e(D,"color","red"),t(D,()=>n.result.message),D}}),w,k),C.$$click=$,M.$$click=S,j(()=>G(F,"value",e.listsId)),j(()=>G(I,"value",u.listLocationsId)),P(),a})()}K(["click"]);var vt=_('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 -960 960 960"><path d="M560-240 320-480l240-240 56 56-184 184 184 184z">');const pt=(e={})=>(()=>{var l=m(vt);return le(l,e,!0,!0),P(),l})();var ft=_('<div class=title><!$><!/> <div><div class=list-name><h1 class="type-display-1 gradient-title"></h1><button class=button-reset></button></div><span class="type-subtitle-2 text-smoke-120">'),xt=_("<main class=list-detail-main><header class=header></header><section></section><!$><!/><!$><!/>");function Ht(){const e={width:24,height:24},[l,{toggleEditListModalOpen:r}]=J(),{id:d}=Pe();ie(()=>Be(),{deferStream:!0});const u=ie(()=>He(Number(d)),{deferStream:!0}),s=ie(()=>Ze(Number(d)),{deferStream:!0});return(()=>{var n=m(xt),$=n.firstChild,S=$.nextSibling,a=S.nextSibling,[h,y]=c(a.nextSibling),g=h.nextSibling,[v,L]=c(g.nextSibling);return t($,i(E,{get when(){return s()},get children(){var f=m(ft),z=f.firstChild,[x,b]=c(z.nextSibling),N=x.nextSibling,w=N.nextSibling,k=w.firstChild,C=k.firstChild,F=C.nextSibling,I=k.nextSibling;return t(f,i(se,{href:"/lists",get children(){return i(pt,X(e,{fill:"#1e64ab"}))}}),x,b),t(C,()=>s().label),F.$$click=()=>r(),t(F,i(ve,X(e,{fill:"#5a6672"}))),t(I,()=>s()?.description),P(),f}})),t(S,i(E,{get when(){return ee(()=>!!u())()&&s()},get children(){return i(dt,{get locations(){return u()},get list(){return s()}})}})),t(n,i(E,{get when(){return s()},get children(){return i(mt,X(s))}}),h,y),t(n,i(bt,{listsId:d}),v,L),n})()}K(["click"]);export{Ht as default};
