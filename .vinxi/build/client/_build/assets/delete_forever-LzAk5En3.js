import{I as f,x as l,f as g,b as v,J as L,K as S,i as w,t as z,j as I,r as k}from"./web-BP_Sm2kp.js";import{u as x,r as m,l as E}from"./index-Da3s7cXh.js";const b=L(),U=()=>S(b),F=e=>{const[a]=x();e.id??=f();const c=(t,n)=>{a.map.debug&&console.debug("%c[MapGL]","color: #ec4899",t,n||"")},r=t=>{const n=t?.split(":").reduce((s,h)=>s&&s[h],m),o=n?{...e.source,url:"",tiles:[n.replace("{apikey}",e.source.apikey||void 0).replace("{r}",window.devicePixelRatio>1?"@2x":"")],attribution:m[t.split(":")[0]]._copy}:e.source;return o.tiles&&(o.tiles=["a","b","c"].map(s=>o.tiles[0].replace("{s}",s))),o};a.map.addSource(e.id,r(e.source.url)),a.map.sourceIdList.push(e.id),c("Add Source:",e.id);const i=a.map.getSource(e.id);switch(e.source.type){case"geojson":l(()=>{const t=e.source.data;a.map.isSourceLoaded(e.id)&&(i.setData(t||{}),c("Update GeoJSON Data:",e.id))});break;case"image":l(()=>{const t=e.source.url,n=e.source.coordinates;a.map.isSourceLoaded(e.id)&&(i.updateImage(t,n),c("Update Image Data:",e.id))});break;case"vector":l(()=>{const t=e.source.url,n=e.source.tiles;a.map.isSourceLoaded(e.id)&&(t?i.setUrl(t):i.setTiles(n),c("Update Vector Data:",e.id))});break;case"raster":l(()=>{const t=r(e.source.url);a.map.isSourceLoaded(e.id)&&(t.url?i.setUrl(t.url):i.setTiles(t.tiles),c("Update Raster Data:",e.id))});break}return g(()=>{a.map?.getStyle().layers.forEach(t=>t.source===e.id&&a.map.removeLayer(t.id)),a.map?.getSource(e.id)&&a.map?.removeSource(e.id),c("Remove Source:",e.id)}),v(b.Provider,{get value(){return e.id},get children(){return e.children}})},j=["id","type","filter","source","source-layer","minzoom","metadata","maxzoom","paint","layout"],C=["visibility","line-join","line-cap","line-miter-limit","line-round-limit","line-sort-key","circle-sort-key","symbol-avoid-edges","symbol-placement","symbol-sort-key","symbol-spacing","symbol-z-order","icon-allow-overlap","icon-anchor","icon-ignore-placement","icon-image","icon-keep-upright","icon-offset","icon-optional","icon-padding","icon-pitch-alignment","icon-rotate","icon-rotation-alignment","icon-size","icon-text-fit","icon-text-fit-padding","text-allow-overlap","text-anchor","text-field","text-font","text-ignore-placement","text-justify","text-keep-upright","text-letter-spacing","text-line-height","text-max-angle","text-max-width","text-offset","text-optional","text-padding","text-pitch-alignment","text-radial-offset","text-rotate","text-rotation-alignment","text-size","text-transform","text-variable-anchor","text-writing-mode"],y=(e={},a={})=>[...new Set([...Object.keys(e),...Object.keys(a)])].reduce((r,i)=>{const t=e[i];return t!==a[i]&&r.push([i,t]),r},[]),d=(e,a)=>(e.startsWith(a)||e.startsWith("icon")||e.startsWith("text")?"":a+"-")+e.replace(/[A-Z]/g,c=>"-"+c.toLowerCase()),u=e=>{if(!e)return;let a={},c={},r={};return Object.entries(e).forEach(([i,t])=>{if(j.includes(i))r[i]=t;else{const n=d(i,e.type);C.includes(n)?a[n]=t:c[n]=t}}),e.paint&&Object.entries(e.paint).forEach(([i,t])=>c[d(i,e.type)]=t),e.layout&&Object.entries(e.layout).forEach(([i,t])=>a[d(i,e.type)]=t),{...r,paint:c,layout:a}},$=e=>{const[a]=x(),c=e.style?.source||U();e.id=e.id||e.customLayer?.id||f();const r=(i,t)=>{a.map.debug&&console.debug("%c[MapGL]","color: #10b981",i,t||"")};return a.map.addLayer(e.customLayer||{...u(e.style),id:e.id,source:c,metadata:{smg:{beforeType:e.beforeType,beforeId:e.beforeId}}},e.beforeType?a.map.getStyle().layers.find(i=>i.type===e.beforeType)?.id:e.beforeId),a.map.layerIdList.push(e.id),e.customLayer&&a.map.fire("load"),r("Add Layer:",e.id),E.forEach(i=>{if(e[i]){const t=i.slice(2).toLowerCase();a.map.on(t,e.id,n=>{n.clickOnLayer=!0,e[i](n),r(`Layer '${t}' event on '${e.id}':`,n)})}}),l(i=>{const t=u(e.style);if(t!==i)return t.layout!==i?.layout&&y(t.layout,i?.layout).forEach(([n,o])=>a.map.setLayoutProperty(e.id,n,o,{validate:!1})),t.paint!==i?.paint&&y(t.paint,i?.paint).forEach(([n,o])=>a.map.setPaintProperty(e.id,n,o,{validate:!1})),(t.minzoom!==i?.minzoom||t.maxzoom!==i?.maxzoom)&&a.map.setLayerZoomRange(e.id,t.minzoom,t.maxzoom),t.filter!==i?.filter&&a.map.setFilter(e.id,t.filter,{validate:!1}),r("Update Layer Style:",e.id),t},u(e.style)),l(i=>{if(e.visible!==i)return a.map.setLayoutProperty(e.id,"visibility",e.visible?"visible":"none",{validate:!1}),r(`Update Visibility (${e.id}):`,e.visible.toString()),e.visible},e.visible),l(async()=>{e.filter&&(!a.map.isStyleLoaded()&&await a.map.once("styledata"),a.map.setFilter(e.id,e.filter),r(`Update Filter (${e.id}):`,e.filter))}),l(async()=>{!e.featureState||e.featureState.id===null||(!a.map.isStyleLoaded()&&await a.map.once("styledata"),a.map.removeFeatureState({source:c,sourceLayer:e.style["source-layer"]}),a.map.setFeatureState({source:c,sourceLayer:e.style["source-layer"],id:e.featureState.id},e.featureState.state))}),g(()=>a.map?.getLayer(e.id)&&a.map?.removeLayer(e.id)),e.children};var T=z('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 -960 960 960"><path d="m376-300 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104zm-96 180q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120zm400-600H280v520h400zm-400 0v520z">');const P=(e={})=>(()=>{var a=w(T);return I(a,e,!0,!0),k(),a})();export{P as D,$ as L,F as S};
