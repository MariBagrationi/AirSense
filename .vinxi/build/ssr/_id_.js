import{createComponent as s,ssr as r,ssrHydrationKey as c,escape as t,ssrElement as L,mergeProps as h,ssrAttribute as p,ssrStyleProperty as T}from"solid-js/web";import{createSignal as v,Show as u,For as D,createEffect as y}from"solid-js";import{M as P,S as E}from"./assets/index-UEaCuu6f.js";import{L as x}from"./assets/index-BAcFkYlj.js";import{C as H,R as Z,a as B,t as O,s as Y,L as V}from"./assets/index-B2bbu6uD.js";import*as j from"maplibre-gl";import k from"@turf/destination";import{u as f}from"./assets/index-BBOR6-eJ.js";import{A as _}from"./assets/components-D-gQuZqx.js";import{L as J,C as U}from"./assets/chevron_right-DN1aOD5j.js";import b from"dayjs";import G from"dayjs/plugin/timezone.js";import K from"dayjs/plugin/utc.js";import{d as W,a as Q}from"./assets/index-CdJOkaK-.js";import{D as R}from"./assets/delete_forever-CU_4vvcr.js";import{C as I}from"./assets/close-CKxkeldA.js";import{c as X,u as A}from"./assets/backend-CxM3g3pI.js";import{i as tt,l as et}from"./assets/routing-BPjDSAJ2.js";import{c as w}from"./assets/createAsync-Dqt8Sub7.js";/* empty css                     */import{u as S,e as C,l as st,a as ot}from"./assets/lists-DLVnc5wO.js";/* empty css                           */import{g as it}from"./assets/user-3VDwjqVg.js";import"solid-js/store";import"dayjs/plugin/relativeTime.js";import"./assets/lists-CnpuNbOq.js";import"d3";import"solid-js/web/storage";import"h3";import"unctx";import"node:async_hooks";import"crypto";import"util";import"nanoid";import"@zxcvbn-ts/core";import"@zxcvbn-ts/language-common";import"@zxcvbn-ts/language-en";function at(e){const n=k(e[0],1,-135,{units:"kilometers"}),a=k(e[2],1,45,{units:"kilometers"});return[...n.geometry.coordinates,...a.geometry.coordinates]}function rt(e){return 2500/(e/5)}function nt(e){const[n,a]=v({bounds:at(e.list.bbox)}),[d,{setSelectedLocationsId:l}]=f();function o(i){const m=i.target.queryRenderedFeatures(i.point),$=m[0].properties.locations_id;return l($),m[0].geometry.coordinates}return s(P,{class:"list-map",mapLib:j,get options(){return{accessToken:"pk.eyJ1IjoibWJhZ3JhdGlvbmkiLCJhIjoiY21nYzdvYzRtMWRlaTJrczdhdmFvY3R1ZSJ9.q1gwOrfrGLBRKTef6ylZzQ",style:"https://api.maptiler.com/maps/dataviz-dark/style.json?key=UhseFH2iDqnVh2izRANY",touchZoomRotate:!1,dragRotate:!1,minZoom:1,maxZoom:20}},get viewport(){return n()},onViewportChange:i=>a(i),onMouseOver:{locations:i=>i.target.getCanvas().style.cursor="pointer"},onMouseLeave:{locations:i=>i.target.getCanvas().style.cursor=""},get children(){return[s(E,{get source(){return{id:"locations",type:"vector",tiles:["https://api.maptiler.com/tiles/streets/{z}/{x}/{y}.pbf?key=UhseFH2iDqnVh2izRANY/{z}/{x}/{y}.pbf?apiKey=UhseFH2iDqnVh2izRANY"],minzoom:1,maxzoom:24}},get children(){return[s(x,{id:"locations",onClick:i=>{const m=o(i);i.target.flyTo({center:m,zoom:i.target.getZoom()>12?i.target.getZoom():12,duration:rt(i.target.getZoom()),essential:!0})},get style(){return{type:"circle","source-layer":"locations",paint:{"circle-color":["case",["in",["get","locations_id"],["literal",e.list.sensorNodesIds]],"transparent","#A9B0BB"],"circle-stroke-color":["case",["in",["get","locations_id"],["literal",e.list.sensorNodesIds]],"transparent","#FFFFFF"],"circle-stroke-width":["interpolate",["linear"],["zoom"],2,1,14,4],"circle-radius":["interpolate",["linear"],["zoom"],1,3,12,14]}}}}),s(x,{id:"listlocations",get style(){return{type:"circle","source-layer":"locations",paint:{"circle-color":["case",["in",["get","locations_id"],["literal",e.list.sensorNodesIds]],"#FEE172","transparent"],"circle-stroke-color":["case",["in",["get","locations_id"],["literal",e.list.sensorNodesIds]],"#33A3A1","transparent"],"circle-stroke-width":["interpolate",["linear"],["zoom"],2,1,14,4],"circle-radius":["interpolate",["linear"],["zoom"],1,3,12,14]}}}})]}}),s(H,{type:"navigation",position:"bottom-left",options:{showCompass:!1,showZoom:!0}})]}})}var lt=["<div",' class="no-locations-fallback"><p class="type-subtitle-1 text-smoke-120">Lists allow you to collect and save a set of monitoring locations for easy access.</p><p class="type-subtitle-2 text-smoke-120">To start adding monitoring locations to your list, first find locations in the <!--$-->','<!--/--> map, and then click on "Add to list".</p></div>'];function ct(){return r(lt,c(),t(s(_,{href:"/",children:"Explore"})))}var dt=["<div",' class="location-info"><div class="location-info__title"><!--$-->',"<!--/--><h3>",'</h3></div><div class="location-info__body"><div><div class="locality">','</div><div class="location-characteristics"><div class="type-body-1">Provider</div><div class="type-body-2">','</div><div class="type-body-1">Type</div><div class="type-body-2">','</div><div class="type-body-1">Measures</div><div class="type-body-2">','</div></div></div><div class="location-measurements">',"</div></div></div>"],mt=["<li",' class="location-list-item"><!--$-->','<!--/--><button class="location-card-delete-btn" type="button">',"</button></li>"],ut=["<ul",' class="location-list">',"</ul>"];b.extend(K);b.extend(G);function pt(e){const n={width:24,height:24,fill:"#FFFFFF"},[a,{setDeleteListLocationsId:d,toggleDeleteListLocationModalOpen:l}]=f(),[o,i]=v(),[m,$]=v(!0),g=()=>e.sensors.filter(q=>Number(q.parameter.id)===Number(a.listParametersId))?.[0]?.id,[z,M]=v([]);return y(async()=>{i(g()),M([]),o()&&M(await W(o(),b.tz(Date.now()-1e3*60*60*24,e.timezone).format(),b.tz(Date.now(),e.timezone).format())),$(!1)}),r(mt,c(),t(s(_,{get href(){return`/locations/${e.id}`},get children(){return r(dt,c(),e.ismonitor?t(s(Z,{})):t(s(B,{})),t(e.name),t(e.country),t(e.provider),e.ismonitor?"Reference Grade":"Air sensor",t(e.sensors.map(F=>`${F.parameter.displayName} ${F.parameter.units}`).join(", ")),t(s(J,{width:400,height:200,margin:60,xTicks:4,get dateFrom(){return b.tz(Date.now()-1e3*60*60*24,e.timezone).format()},get dateTo(){return b.tz(Date.now(),e.timezone).format()},get data(){return z()},scale:"linear",get loading(){return m()},get timezone(){return e.timezone},get noDataMessage(){return`This location does not measure ${a.listParameter}`}})))}})),t(s(R,n)))}function ht(e){return r(ut,c(),t(s(u,{get when(){return e.locations.length>0},get fallback(){return s(ct,{})},get children(){return s(D,{get each(){return e.locations},children:n=>s(pt,n)})}})))}var vt=["<div",' class="','"><header class="location-detail-card-mini__header"><div><h3 class="type-heading-3 text-white">','</h3></div><div><button class="close-btn"> <!--$-->','<!--/--> </button></div></header><div class="location-detail-card-mini__body"><section class="section"><span class="type-body-3">','</span></section><section class="section-grid"><span class="type-subtitle-3">Type</span><span class="type-body-1">','</span><span class="type-subtitle-3">Measures</span><span class="type-body-1">','</span></section><section class="section-grid"><span class="type-subtitle-3">Source</span><span class="type-body-1">','</span><span class="type-subtitle-3">Reporting</span><div class="reporting-cell"><span class="type-body-1">','</span><span class="type-body-4">','</span></div></section></div><footer class="location-detail-card-mini__footer"><!--$-->',"<!--/--><!--$-->","<!--/--></footer></div>"];function gt(){const e={width:24,height:24,fill:"#FFFFFF"},n=tt(),a=w(()=>X(),{deferStream:!0}),[d,{clearLocationsId:l}]=f(),[o,i]=v();return y(async()=>{d.locationsId&&i(await Q(d.locationsId))}),r(vt,c(),`location-detail-card-mini ${d.locationsId?"":"location-detail-card-mini--translate"}`,t(o()?.results?.[0].name),t(s(I,e)),t(o()?.results?.[0].country.name),o()?.results?.[0].isMonitor?"Reference grade":"Air sensor",t(o()?.results?.[0].sensors.map(m=>`${m.parameter.displayName} ${m.parameter.units}`).join(", ")),t(o()?.results?.[0].provider.name),o()?.results?.[0].datetimeLast?`Updated ${t(O(o()?.results?.[0].datetimeFirst?.local))}`:"No measurements",o()?.results?.[0].datetimeLast?`Reporting since ${t(Y(o()?.results?.[0].datetimeFirst?.local))}`:"No measurements",t(s(u,{get when(){return a()?.usersId},get children(){return s(V,{get redirect(){return n.pathname}})}})),t(s(_,{get href(){return`/locations/${d.locationsId}`},class:"icon-btn btn-primary",get children(){return["Show Details ",s(U,e)]}})))}var ft='<path d="m600-120-240-84-186 72q-20 8-37-4.5T120-170v-560q0-13 7.5-23t20.5-15l212-72 240 84 186-72q20-8 37 4.5t17 33.5v560q0 13-7.5 23T812-192zm-40-98v-468l-160-56v468zm80 0 120-40v-474l-120 46zm-440-10 120-46v-468l-120 40zm440-458v468zm-320-56v468z"></path>';const bt=(e={})=>L("svg",h({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 -960 960 960"},e),()=>r(ft),!0);var yt='<path d="M360-240h440v-107H360zM160-613h120v-107H160zm0 187h120v-107H160zm0 186h120v-107H160zm200-186h440v-107H360zm0-187h440v-107H360zM160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160z"></path>';const $t=(e={})=>L("svg",h({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 -960 960 960"},e),()=>r(yt),!0);var wt=["<div",' class="list-controls"><label for="parameter-select">Parameters</label><select name="parameter-select" id class="select"',">","</select></div>"],Lt=["<div",' id="list-view">',"</div>"],_t=["<div",' id="map-view"><!--$-->',"<!--/--><!--$-->","<!--/--></div>"],zt=["<div",' class="tab-view"><header class="tab-view__header"><nav class="tab-nav"><a href="#"><div class="','"><!--$-->','<!--/-->List</div></a><a href="#"><div class="','"><!--$-->',"<!--/-->Map</div></a></nav><!--$-->","<!--/--></header><section><!--$-->","<!--/--><!--$-->","<!--/--></section></div>"],Ft=["<option","><!--$-->","<!--/--> <!--$-->","<!--/--> </option>"];function It(e){const n={width:24,height:24},[a,d]=v("list"),[l,o]=v([]),[i,{setListParametersId:m,setListParameter:$}]=f();return y(()=>{e.locations&&(o([...new Set(...e.locations.map(g=>g.sensors.map(z=>z.parameter)))]),l.length>0&&m(l()[0].id))}),r(zt,c(),`tab ${a()=="list"?"tab--active":""}`,t(s($t,h(n,{get class(){return`tab-icon ${a()=="list"?"tab-icon--active":""}`}}))),`tab ${a()=="map"?"tab--active":""}`,t(s(bt,h(n,{get class(){return`$'tab-icon' ${a()=="map"?"tab-icon--active":""}`}}))),t(s(u,{get when(){return a()=="list"&&e.locations.length>0},get children(){return r(wt,c(),p("value",t(i.listParametersId,!0),!1),t(s(D,{get each(){return l()},children:g=>r(Ft,c()+p("value",t(g.id,!0),!1),t(g.displayName),t(g.units))})))}})),t(s(u,{get when(){return a()=="list"},get children(){return r(Lt,c(),t(s(ht,e)))}})),t(s(u,{get when(){return a()=="map"},get children(){return r(_t,c(),t(s(nt,e)),t(s(gt,{})))}})))}var Mt='<path d="M200-200h57l391-391-57-57-391 391zm-80 80v-170l528-527q12-11 26.5-17t30.5-6 31 6 26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120zm640-584-56-56zm-141 85-28-29 57 57z"></path>';const N=(e={})=>L("svg",h({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 -960 960 960"},e),()=>r(Mt),!0);var xt=["<p",' style="','" role="alert" id="error-message">',"</p>"],kt=["<dialog",' class="modal"><form',' method="post"><input type="hidden" name="lists-id"','><header class="modal__header"><h2 class="title"><!--$-->','<!--/-->Edit list</h2><button id="close" class="close-btn" aria-label="close" formnovalidate>','</button></header><div class="modal__body"><div class="form-input"><label for="list-name">Name</label><div class="form-input"><input type="text" name="list-name" id="list-name-input" class="text-input"','></div><label for="list-description">Description</label><input type="text" name="list-description" id="list-description-input" class="text-input"','></div></div><footer class="modal__footer"><!--$-->','<!--/--><button class="btn btn-secondary" id="cancel" aria-label="close" formnovalidate autofocus>Cancel</button><button class="btn btn-primary" type="submit" autofocus>Create</button></footer></form></dialog>'];function St(e){const n={width:24,height:24,fill:"#FFFFFF"},[a,{toggleEditListModalOpen:d}]=f(),l=A(S),[o,i]=v();return y(()=>{a.editListModalOpen&&o()?.showModal()}),r(kt,c(),p("action",t(S,!0),!1),p("value",t(e.listsId,!0),!1),t(s(N,n)),t(s(I,n)),p("value",t(e.label,!0),!1),p("value",t(e.description,!0),!1),t(s(u,{get when(){return l.result},get children(){return r(xt,c(),T("color:","red"),t(l.result.message))}})))}var Ct=["<p",' style="','" role="alert" id="error-message">',"</p>"],Tt=["<dialog",' class="modal"><form',' method="post"><header class="modal__header"><h2 class="title"><!--$-->','<!--/-->Remove location?</h2><button id="close" class="close-btn" aria-label="close" formnovalidate>','</button></header><div class="modal__body"><p><span class="type-subtitle-4">Warning</span> You are about to remove this location from your list. Click Delete if you are you sure want to proceed.</p></div><footer class="modal__footer"><!--$-->','<!--/--><button class="btn btn-secondary" id="cancel" aria-label="close" formnovalidate autofocus>Cancel</button><input name="lists-id" type="hidden"','><input name="locations-id" type="hidden"','><button class="btn btn-primary" type="submit" autofocus>Delete</button></footer></form></dialog>'];function Dt(e){const n={width:24,height:24,fill:"#FFFFFF"},[a,d]=v(),[l,{toggleDeleteListLocationModalOpen:o}]=f(),i=A(C);return y(()=>{l.deleteListLocationModalOpen&&a()?.showModal()}),r(Tt,c(),p("action",t(C,!0),!1),t(s(R,n)),t(s(I,n)),t(s(u,{get when(){return i.result},get children(){return r(Ct,c(),T("color:","red"),t(i.result.message))}})),p("value",t(e.listsId,!0),!1),p("value",t(l.listLocationsId,!0),!1))}var Rt='<path d="M560-240 320-480l240-240 56 56-184 184 184 184z"></path>';const At=(e={})=>L("svg",h({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 -960 960 960"},e),()=>r(Rt),!0);var Nt=["<div",' class="title"><!--$-->','<!--/--> <div><div class="list-name"><h1 class="type-display-1 gradient-title">','</h1><button class="button-reset">','</button></div><span class="type-subtitle-2 text-smoke-120">',"</span></div></div>"],qt=["<main",' class="list-detail-main"><header class="header">',"</header><section>","</section><!--$-->","<!--/--><!--$-->","<!--/--></main>"];function $e(){const e={width:24,height:24},[n,{toggleEditListModalOpen:a}]=f(),{id:d}=et();w(()=>it(),{deferStream:!0});const l=w(()=>st(Number(d)),{deferStream:!0}),o=w(()=>ot(Number(d)),{deferStream:!0});return r(qt,c(),t(s(u,{get when(){return o()},get children(){return r(Nt,c(),t(s(_,{href:"/lists",get children(){return s(At,h(e,{fill:"#1e64ab"}))}})),t(o().label),t(s(N,h(e,{fill:"#5a6672"}))),t(o()?.description))}})),t(s(u,{get when(){return l()&&o()},get children(){return s(It,{get locations(){return l()},get list(){return o()}})}})),t(s(u,{get when(){return o()},get children(){return s(St,h(o))}})),t(s(Dt,{listsId:d})))}export{$e as default};
