import{ssr as i,ssrHydrationKey as c,escape as t,ssrAttribute as p,createComponent as r,ssrStyleProperty as k}from"solid-js/web";import{u as h}from"./assets/index-DGFWRD0-.js";import{createSignal as $,createEffect as A,Show as w}from"solid-js";import{j as I,k as P,b as S,r as n,l as g,u as C}from"./assets/backend-hM8sUyp6.js";import{c as K,e as F,a as U,g as M}from"./assets/user-C3LDJoBY.js";import O from"dayjs";import j from"dayjs/plugin/utc.js";/* empty css                     */import{C as E}from"./assets/close-CKxkeldA.js";/* empty css                       */import{c as N}from"./assets/createAsync-Dqt8Sub7.js";import"solid-js/store";import"./assets/routing-BfDgGOS4.js";import"solid-js/web/storage";import"h3";import"node:async_hooks";import"crypto";import"util";import"nanoid";import"@zxcvbn-ts/core";import"@zxcvbn-ts/language-common";import"@zxcvbn-ts/language-en";var T=["<div",' class="','"><span class="type-body-3">',"</span></div>"];function q(e){const[s]=h();return i(T,c(),`toast ${s.toastOpen?"":"toast--translate"}`,t(e.message))}O.extend(j);const H=P(async e=>{const l=(await S())?.usersId;if(!l)throw n("/");const a=String(e.get("current-password")),d=String(e.get("new-password")),f=String(e.get("confirm-new-password"));if(d!=f)return new Error("New password fields must match");const o=await g.getUserById(l);if(o.status===404)throw n("/");const u=await o.json();if(!u[0].isActive)throw n("/verify-email");const m=await K(a,u[0].passwordHash),R=await F(d);if(!m)return new Error("Invalid credentials");const y=U(d);if(y.score<4)return new Error(`New password too weak: ${y.feedback.warning}`);try{const x=await(await g.updateUserPassword({usersId:u[0].usersId,passwordHash:R})).json();console.info(`User ID ${x.usersid} changed password.`)}catch(b){return console.error(`password change failed: ${JSON.stringify(b)}`),new Error("Failed to password change")}throw n("/account")},"src_db_account_ts--changePassword_action","C:/Users/MARIAM/Desktop/AirSense/AirSense/src/db/account.ts?tsr-directive-use-server="),v=I(H,"change-password-action"),B=P(async e=>{const s=String(e.get("token")),a=(await S())?.usersId;if(!a)throw n("/login");const d=await g.getUserById(a);if(!a)throw n("/login");if((await d.json()).length===0)throw n("/login");const o=new URL("https://api.openaq.org");o.pathname="/auth/regenerate-token";const u={usersId:a,token:s};try{await(await fetch(o.href,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":"be79fbc7b35789af970752f816b8bf9b79a5198ef9157a4c596e27a5bd70fa40"},body:JSON.stringify(u)})).json()}catch(m){return console.error(`Regenerate key failed: ${m}`),new Error("Failed to update key")}throw n("/account")},"src_db_account_ts--regenerateKey_action","C:/Users/MARIAM/Desktop/AirSense/AirSense/src/db/account.ts?tsr-directive-use-server="),_=I(B);var J=["<p",' style="','" role="alert" id="error-message">',"</p>"],L=["<form",' class="password-form" name="password-form" id="password-form"',' method="post"><div class="form-element"><label for="current-password">Current password</label><input type="password" name="current-password" id="current-password" class="text-input"></div><div class="form-element"><label for="new-password">New password</label><input type="password" name="new-password" id="new-password" class="text-input"></div><div class="form-element"><label for="confirm-new-password">Confirm new password</label><input type="password" name="confirm-new-password" id="confirm-new-password" class="text-input"></div><div class="form-element"><!--$-->','<!--/--><div><button type="submit" class="btn btn-primary"',">Change password</button></div></div></form>"];function W(){const e=C(v),[s,l]=$();return A(()=>{e.pending||s()?.reset()}),i(L,c(),p("action",t(v,!0),!1),t(r(w,{get when(){return e.result},get children(){return i(J,c(),k("color:","red"),t(e.result?.message))}})),p("disabled",e.pending,!0))}var D=["<p",' style="','" role="alert" id="error-message">',"</p>"],Q=["<dialog",' class="modal"><form',' name="regenerate-key-form" id="regenerate-key-form" method="post"><header class="modal__header"><h2>Regenerate API Key</h2><button id="close" class="close-btn" aria-label="close" formnovalidate>','</button></header><div class="modal__body">Warning: The current key will stop working when a new key is regenerated</div><footer class="modal__footer"><button class="btn btn-secondary" id="cancel" aria-label="close" formnovalidate autofocus>Cancel</button><!--$-->','<!--/--><input type="hidden" name="token"','><button class="btn btn-primary" type="submit" autofocus>Regenerate</button></footer></form></dialog>'];function X(e){const s={width:24,height:24,fill:"#FFFFFF"},[l,{toggleRegenerateKeyModalOpen:a}]=h(),[d,f]=$();A(()=>{l.apiKeyRegenerateModalOpen&&d()?.showModal()});const o=C(_);return i(Q,c(),p("action",t(_,!0),!1),t(r(E,s)),t(r(w,{get when(){return o.result},get children(){return i(D,c(),k("color:","red"),t(o.result?.message))}})),p("value",t(e.token,!0),!1))}var z=["<span",' class="inactive-account-warning">ðŸš« API usage for this account has been temporarily suspended due to violation of the platform <a href="https://docs.openaq.org/about/terms">Terms of Use</a>. Please contact <a href="mailto:dev@openaq.org">dev@openaq.org</a>.</span>'],G=["<button",' class="btn btn-primary">Regenerate</button>'],V=["<main",' class="account-page"><!--$-->','<!--/--><h1 class="type-display-1 text-sky-120">OpenAQ Account</h1><section class="account-page__section"><h2 class="type-heading-2 text-sky-120">Basics</h2><div class="form-element"><label for="name">Name</label><input type="text" name="name" id="name" class="text-input"','></div><div class="form-element"><label for="name">Email</label><input type="email" name="email" id="email" class="text-input"','></div></section><section class="account-page__section"><h2 class="type-heading-2 text-sky-120">Change password</h2><!--$-->','<!--/--></section><section class="account-page__section"><h2 class="type-heading-2 text-sky-120">API Key</h2><!--$-->','<!--/--><input class="text-input"','><div class="api-key-buttons"><button class="btn btn-primary">Copy</button><!--$-->',"<!--/--></div></section><!--$-->","<!--/--></main>"];function Y(){return i(z,c())}function _e(){const e=N(()=>M(),{deferStream:!0}),[s,{openToast:l,toggleRegenerateKeyModalOpen:a}]=h();return i(V,c(),t(r(X,{get token(){return e()?.token}})),p("value",t(e()?.fullname,!0),!1),p("value",t(e()?.email,!0),!1),t(r(W,{})),t(r(w,{get when(){return!e()?.isActive},get children(){return r(Y,{})}})),p("value",t(e()?.token,!0),!1),t(r(w,{get when(){return e()?.isActive},get children(){return i(G,c())}})),t(r(q,{message:"API Key copied to clipboard"})))}export{_e as default};
