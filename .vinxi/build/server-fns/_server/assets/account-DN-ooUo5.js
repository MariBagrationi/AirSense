import{k as f,b as g,r as s,l as c}from"./backend-DPj8aydh.js";import{c as l,e as y,a as b}from"./user-Csyx7oEn.js";import I from"dayjs";import S from"dayjs/plugin/utc.js";import"solid-js";import"solid-js/web";import"./routing-BfDgGOS4.js";import"solid-js/web/storage";import"h3";import"unctx";import"node:async_hooks";import"crypto";import"util";import"nanoid";import"@zxcvbn-ts/core";import"@zxcvbn-ts/language-common";import"@zxcvbn-ts/language-en";I.extend(S);const B=f(async r=>{const i=(await g())?.usersId;if(!i)throw s("/");const e=String(r.get("current-password")),t=String(r.get("new-password")),w=String(r.get("confirm-new-password"));if(t!=w)return new Error("New password fields must match");const o=await c.getUserById(i);if(o.status===404)throw s("/");const a=await o.json();if(!a[0].isActive)throw s("/verify-email");const n=await l(e,a[0].passwordHash),h=await y(t);if(!n)return new Error("Invalid credentials");const p=b(t);if(p.score<4)return new Error(`New password too weak: ${p.feedback.warning}`);try{const m=await(await c.updateUserPassword({usersId:a[0].usersId,passwordHash:h})).json();console.info(`User ID ${m.usersid} changed password.`)}catch(u){return console.error(`password change failed: ${JSON.stringify(u)}`),new Error("Failed to password change")}throw s("/account")},"src_db_account_ts--changePassword_action","C:/Users/MARIAM/Desktop/AirSense/AirSense/src/db/account.ts?tsr-directive-use-server="),F=f(async r=>{const d=String(r.get("token")),e=(await g())?.usersId;if(!e)throw s("/login");const t=await c.getUserById(e);if(!e)throw s("/login");if((await t.json()).length===0)throw s("/login");const o=new URL("https://api.openaq.org");o.pathname="/auth/regenerate-token";const a={usersId:e,token:d};try{await(await fetch(o.href,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":"be79fbc7b35789af970752f816b8bf9b79a5198ef9157a4c596e27a5bd70fa40"},body:JSON.stringify(a)})).json()}catch(n){return console.error(`Regenerate key failed: ${n}`),new Error("Failed to update key")}throw s("/account")},"src_db_account_ts--regenerateKey_action","C:/Users/MARIAM/Desktop/AirSense/AirSense/src/db/account.ts?tsr-directive-use-server=");export{B as changePassword_action,F as regenerateKey_action};
