import{ssr as m,ssrHydrationKey as s,ssrStyleProperty as $,escape as e,createComponent as g,ssrAttribute as r,ssrElement as U,mergeProps as V}from"solid-js/web";import{area as Y,line as E,scaleTime as P,extent as W,scaleLinear as j,scaleSymlog as I,min as K,max as k,axisLeft as D,select as _,axisBottom as O,timeFormat as d,timeSecond as Z,timeMinute as q,timeHour as J,timeDay as N,timeMonth as Q,timeWeek as X,timeYear as p}from"d3";import{createSignal as tt,createEffect as et,For as M,Show as v}from"solid-js";import u from"dayjs";import it from"dayjs/plugin/timezone.js";import at from"dayjs/plugin/utc.js";var nt=["<line",' stroke="#6A5CD8" stroke-width="1"></line>'],lt=["<circle",' class="line-chart-point-highlight"',' r="9"></circle>'],rt=["<rect",' x="0" y="0" rx="5" ry="5" width="40" height="25" fill="#6A5CD8" transform="','"></rect>'],ct=["<text",' text-anchor="middle"',">Loading...</text>"],ot=["<text",' text-anchor="middle"',">","</text>"],mt=["<text",' x="0" y="0" font-size="12" fill="white" transform="','">',"</text>"],st=["<div",' style="','"><div class="line-chart-tooltip" style="','"><span class="line-chart-tooltip__value">','</span> <span class="line-chart-tooltip__unit">','</span></div><svg width="','" height="','"><defs><linearGradient id="area-gradient" gradientUnits="userSpaceOnUse" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#d4cdf9" stop-opacity="0.7"></stop><stop offset="95%" stop-color="white" stop-opacity="0.7"></stop></linearGradient></defs><filter id="shadow" color-interpolation-filters="sRGB"><feDropShadow dx="2" dy="2" stdDeviation="0.5" flood-opacity="0.2"></feDropShadow></filter><g transform="','">','</g><g class="grid" transform="','"></g><g transform="','"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->",'<!--/--></g><g class="y-axis" transform="','"></g><g class="x-axis" transform="','"></g><g transform="','">',"</g></svg></div>"],ut=["<path",' class="line-chart-area"',"></path>"],ht=["<path",' class="line-chart-line"',"></path>"],dt=["<circle",' class="line-chart-point"',"></circle>"];u.extend(at);u.extend(it);const gt=d(".%L"),ft=d(":%S"),xt=d("%H:%M"),yt=d("%H:%M"),$t=d("%b %d"),vt=d("%b %d"),wt=d("%B"),zt=d("%Y");function St(t,a){return(Z(t)<t?gt:q(t)<t?ft:J(t)<t?xt:N(t)<t?yt:Q(t)<t?X(t)<t?$t:vt:p(t)<t?wt:zt)(new Date(t.toLocaleString("en-US",{timeZone:a})))}function F(t,a){let f=[],h;return!t||t.length===0?[[]]:(t.filter(c=>c.value!==null).reduce((c,x,w,z)=>{const y=u(x.period.datetimeTo.local,a);return h===void 0||(y-h)/(3600*1e3)===1||(f.push(c),c=[]),c.push(x),w===z.length-1&&c.length>0&&f.push(c),h=y,c},[]),f)}function Ht(t){const[a,f]=tt({}),h=(i,l,n)=>{const o=P().range([0,i]);return o.domain(W([u(l,t.timezone),u(n,t.timezone)])),o},c=(i,l,n)=>{let o;i=="linear"?o=j().range([l,0]):o=I().range([l,0]);const T=n==null?0:K(n,S=>S.value),B=T<0?T:0,G=n==null?0:k(n,()=>k(n,S=>S.value))*1.2;return o.domain([B,G]),o},x=i=>D(i).ticks(5),w=(i,l)=>D(i).tickSize(-l).tickFormat("").ticks(5),z=i=>O(i).ticks(t.xTicks).tickFormat(l=>St(l,t.timezone)),y=(i,l,n)=>i.map(o=>({value:o.value,cx:l(u(o.period.datetimeTo.local,t.timezone)),cy:n(o.value),unit:o.parameter.units,date:u(o.period.datetimeTo.local,t.timezone)})),A=(i,l)=>E().x(n=>i(u(n.period.datetimeTo.local,t.timezone))).y(n=>l(n.value)),H=(i,l)=>Y().x(n=>i(u(n.period.datetimeTo.local,t.timezone))).y0(t.height).y1(n=>l(n.value));let L,b,C;function R(){if(t.data){const i=h(t.width,t.dateFrom,t.dateTo),l=c(t.scale,t.height,t.data),n=w(l,t.width);_(b).call(z(i)),_(L).call(x(l)),_(C).call(n)}}return et(()=>R()),m(st,s(),$("position:","relative"),$("display:",a()?.visible?"flex":"none")+$(";left:",`${e(a()?.x,!0)-65}px`)+$(";top:",`${e(a()?.y,!0)+5}px`),e(a()?.value),e(a()?.unit),`${e(t.width,!0)+e(t.margin,!0)}px`,`${e(t.height,!0)+e(t.margin,!0)}px`,`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2})`,e(g(M,{get each(){return F(t.data,t.timezone)},children:i=>m(ut,s(),r("d",e(H(h(t.width,t.dateFrom,t.dateTo),c(t.scale,t.height,t.data))(i),!0),!1))})),`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2} )`,`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2})`,e(g(M,{get each(){return F(t.data,t.timezone)},children:i=>m(ht,s(),r("d",e(A(h(t.width,t.dateFrom,t.dateTo),c(t.scale,t.height,t.data))(i),!0),!1))})),e(g(v,{get when(){return a()?.visible},get children(){return[m(nt,s()+r("x1",e(a()?.x,!0),!1)+r("y1",e(t.height,!0),!1)+r("x2",e(a()?.x,!0),!1)+r("y2",e(a()?.y,!0),!1)),m(lt,s(),r("cx",e(a()?.x,!0),!1)+r("cy",e(a()?.y,!0),!1)),m(rt,s(),`translate(${e(a()?.x,!0)-20},${e(t.height,!0)})`)]}})),e(g(M,{get each(){return y(t.data.filter(i=>i.value!==null)??[],h(t.width,t.dateFrom,t.dateTo),c(t.scale,t.height,t.data))},children:i=>m(dt,s(),r("cx",e(i.cx,!0),!1)+r("cy",e(i.cy,!0),!1)+r("r",i.cx==a()?.x?5:3,!1))})),e(g(v,{get when(){return t.loading},get children(){return m(ct,s(),r("x",e(t.width,!0)/2,!1)+r("y",e(t.height,!0)/2,!1))}})),e(g(v,{get when(){return t.data==null||t.data.length===0&&t.loading===!1},get children(){return m(ot,s(),r("x",e(t.width,!0)/2,!1)+r("y",e(t.height,!0)/2,!1),e(t.noDataMessage))}})),`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2})`,`translate(${e(t.margin,!0)/2} ${e(t.height,!0)+e(t.margin,!0)/2})`,`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2})`,e(g(v,{get when(){return a()?.visible},get children(){return m(mt,s(),`translate(${e(a()?.x,!0)-16},${e(t.height,!0)+17})`,e(a()?.date.tz(t.timezone).format("HH:mm")))}})))}var _t='<path d="M504-480 320-664l56-56 240 240-240 240-56-56z"></path>';const Lt=(t={})=>U("svg",V({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 -960 960 960"},t),()=>m(_t),!0);export{Lt as C,Ht as L};
