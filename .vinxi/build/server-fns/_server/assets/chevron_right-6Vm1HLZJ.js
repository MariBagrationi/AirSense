import{splitProps as V,createSignal as D,createEffect as z,untrack as Y,onCleanup as E,For as S,Show as $}from"solid-js";import{u as W}from"./maplibre-gl-Ukol7sIV.js";import{ssr as m,ssrHydrationKey as u,ssrStyleProperty as v,escape as e,createComponent as g,ssrAttribute as o,ssrElement as j,mergeProps as I}from"solid-js/web";import{area as K,line as N,scaleTime as O,extent as Z,scaleLinear as q,scaleSymlog as J,min as Q,max as _,axisLeft as T,select as b,axisBottom as X,timeFormat as h,timeSecond as p,timeMinute as tt,timeHour as et,timeDay as at,timeMonth as it,timeWeek as nt,timeYear as lt}from"d3";import d from"dayjs";import rt from"dayjs/plugin/timezone.js";import ot from"dayjs/plugin/utc.js";const Rt=t=>{const[a]=W(),[f,s]=V(t,["position"]),[n,x]=D(null),w=new Map([["navigation",window.MapLib.NavigationControl],["scale",window.MapLib.ScaleControl],["attribution",window.MapLib.AttributionControl],["geolocate",window.MapLib.GeolocateControl],["fullscreen",window.MapLib.FullscreenControl],["logo",window.MapLib.LogoControl],["terrain",window.MapLib.TerrainControl]]);return z(()=>{Y(()=>n()&&a.map.hasControl(n())&&a.map.removeControl(n())),x(s.custom||new(w.get(s.type||"navigation"))(s.options))}),z(()=>{a.map.hasControl(n())&&a.map.removeControl(n()),a.map.addControl(n(),f.position)}),E(()=>{a.map.hasControl(n())&&a.map.removeControl(n())}),null};var ct=["<line",' stroke="#6A5CD8" stroke-width="1"></line>'],st=["<circle",' class="line-chart-point-highlight"',' r="9"></circle>'],mt=["<rect",' x="0" y="0" rx="5" ry="5" width="40" height="25" fill="#6A5CD8" transform="','"></rect>'],ut=["<text",' text-anchor="middle"',">Loading...</text>"],dt=["<text",' text-anchor="middle"',">","</text>"],ht=["<text",' x="0" y="0" font-size="12" fill="white" transform="','">',"</text>"],gt=["<div",' style="','"><div class="line-chart-tooltip" style="','"><span class="line-chart-tooltip__value">','</span> <span class="line-chart-tooltip__unit">','</span></div><svg width="','" height="','"><defs><linearGradient id="area-gradient" gradientUnits="userSpaceOnUse" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#d4cdf9" stop-opacity="0.7"></stop><stop offset="95%" stop-color="white" stop-opacity="0.7"></stop></linearGradient></defs><filter id="shadow" color-interpolation-filters="sRGB"><feDropShadow dx="2" dy="2" stdDeviation="0.5" flood-opacity="0.2"></feDropShadow></filter><g transform="','">','</g><g class="grid" transform="','"></g><g transform="','"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->",'<!--/--></g><g class="y-axis" transform="','"></g><g class="x-axis" transform="','"></g><g transform="','">',"</g></svg></div>"],ft=["<path",' class="line-chart-area"',"></path>"],xt=["<path",' class="line-chart-line"',"></path>"],wt=["<circle",' class="line-chart-point"',"></circle>"];d.extend(ot);d.extend(rt);const yt=h(".%L"),$t=h(":%S"),vt=h("%H:%M"),Ct=h("%H:%M"),Mt=h("%b %d"),St=h("%b %d"),bt=h("%B"),zt=h("%Y");function Lt(t,a){return(p(t)<t?yt:tt(t)<t?$t:et(t)<t?vt:at(t)<t?Ct:it(t)<t?nt(t)<t?Mt:St:lt(t)<t?bt:zt)(new Date(t.toLocaleString("en-US",{timeZone:a})))}function k(t,a){let f=[],s;return!t||t.length===0?[[]]:(t.filter(n=>n.value!==null).reduce((n,x,w,C)=>{const y=d(x.period.datetimeTo.local,a);return s===void 0||(y-s)/(3600*1e3)===1||(f.push(n),n=[]),n.push(x),w===C.length-1&&n.length>0&&f.push(n),s=y,n},[]),f)}function Bt(t){const[a,f]=D({}),s=(i,r,l)=>{const c=O().range([0,i]);return c.domain(Z([d(r,t.timezone),d(l,t.timezone)])),c},n=(i,r,l)=>{let c;i=="linear"?c=q().range([r,0]):c=J().range([r,0]);const L=l==null?0:Q(l,M=>M.value),P=L<0?L:0,U=l==null?0:_(l,()=>_(l,M=>M.value))*1.2;return c.domain([P,U]),c},x=i=>T(i).ticks(5),w=(i,r)=>T(i).tickSize(-r).tickFormat("").ticks(5),C=i=>X(i).ticks(t.xTicks).tickFormat(r=>Lt(r,t.timezone)),y=(i,r,l)=>i.map(c=>({value:c.value,cx:r(d(c.period.datetimeTo.local,t.timezone)),cy:l(c.value),unit:c.parameter.units,date:d(c.period.datetimeTo.local,t.timezone)})),F=(i,r)=>N().x(l=>i(d(l.period.datetimeTo.local,t.timezone))).y(l=>r(l.value)),A=(i,r)=>K().x(l=>i(d(l.period.datetimeTo.local,t.timezone))).y0(t.height).y1(l=>r(l.value));let H,G,R;function B(){if(t.data){const i=s(t.width,t.dateFrom,t.dateTo),r=n(t.scale,t.height,t.data),l=w(r,t.width);b(G).call(C(i)),b(H).call(x(r)),b(R).call(l)}}return z(()=>B()),m(gt,u(),v("position:","relative"),v("display:",a()?.visible?"flex":"none")+v(";left:",`${e(a()?.x,!0)-65}px`)+v(";top:",`${e(a()?.y,!0)+5}px`),e(a()?.value),e(a()?.unit),`${e(t.width,!0)+e(t.margin,!0)}px`,`${e(t.height,!0)+e(t.margin,!0)}px`,`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2})`,e(g(S,{get each(){return k(t.data,t.timezone)},children:i=>m(ft,u(),o("d",e(A(s(t.width,t.dateFrom,t.dateTo),n(t.scale,t.height,t.data))(i),!0),!1))})),`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2} )`,`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2})`,e(g(S,{get each(){return k(t.data,t.timezone)},children:i=>m(xt,u(),o("d",e(F(s(t.width,t.dateFrom,t.dateTo),n(t.scale,t.height,t.data))(i),!0),!1))})),e(g($,{get when(){return a()?.visible},get children(){return[m(ct,u()+o("x1",e(a()?.x,!0),!1)+o("y1",e(t.height,!0),!1)+o("x2",e(a()?.x,!0),!1)+o("y2",e(a()?.y,!0),!1)),m(st,u(),o("cx",e(a()?.x,!0),!1)+o("cy",e(a()?.y,!0),!1)),m(mt,u(),`translate(${e(a()?.x,!0)-20},${e(t.height,!0)})`)]}})),e(g(S,{get each(){return y(t.data.filter(i=>i.value!==null)??[],s(t.width,t.dateFrom,t.dateTo),n(t.scale,t.height,t.data))},children:i=>m(wt,u(),o("cx",e(i.cx,!0),!1)+o("cy",e(i.cy,!0),!1)+o("r",i.cx==a()?.x?5:3,!1))})),e(g($,{get when(){return t.loading},get children(){return m(ut,u(),o("x",e(t.width,!0)/2,!1)+o("y",e(t.height,!0)/2,!1))}})),e(g($,{get when(){return t.data==null||t.data.length===0&&t.loading===!1},get children(){return m(dt,u(),o("x",e(t.width,!0)/2,!1)+o("y",e(t.height,!0)/2,!1),e(t.noDataMessage))}})),`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2})`,`translate(${e(t.margin,!0)/2} ${e(t.height,!0)+e(t.margin,!0)/2})`,`translate(${e(t.margin,!0)/2} ${e(t.margin,!0)/2})`,e(g($,{get when(){return a()?.visible},get children(){return m(ht,u(),`translate(${e(a()?.x,!0)-16},${e(t.height,!0)+17})`,e(a()?.date.tz(t.timezone).format("HH:mm")))}})))}var _t='<path d="M504-480 320-664l56-56 240 240-240 240-56-56z"></path>';const Pt=(t={})=>j("svg",I({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 -960 960 960"},t),()=>m(_t),!0);export{Rt as C,Bt as L,Pt as a};
